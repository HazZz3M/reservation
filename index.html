<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phone Number or Name Search</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 10px;
    }
    input[type="text"], input[type="number"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    button {
      background-color: #4285f4;
      color: white;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
      margin-right: 5px;
    }
    button:hover {
      background-color: #357ae8;
    }
    .result {
      margin-top: 15px;
      font-size: 14px;
    }
    .new-row {
      margin-top: 20px;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <h3>Search by Phone Number or Name</h3>
  <label for="searchType">Choose search type:</label>
  <select id="searchType">
    <option value="phone">Phone Number (Last 4 Digits)</option>
    <option value="name">Name</option>
  </select>
  <input type="text" id="searchInput" placeholder="Enter query" />
  <button onclick="performSearch()">Search</button>

  <div class="result" id="result"></div>
  <div class="new-row" id="newRow" style="display: none;">
    <h4>No match found. Add new row:</h4>
    <input type="text" id="newName" placeholder="Enter Name" />
    <input type="number" id="newPhone" placeholder="Enter Phone Number" />
    <button onclick="addNewRow()">Add Row</button>
  </div>

  <script>
    function performSearch() {
      const query = document.getElementById('searchInput').value;
      const searchType = document.getElementById('searchType').value;
      
      if (!query) {
        document.getElementById('result').innerHTML = '<p style="color:red;">Please enter a query to search.</p>';
        return;
      }

      google.script.run.withSuccessHandler(displayResults).search(query, searchType);
    }

    function displayResults(results) {
      if (results === 'not found') {
        document.getElementById('result').innerHTML = '<p>No match found for the entered query.</p>';
        document.getElementById('newRow').style.display = 'block'; // Show the "Add new row" section
      } else {
        let output = '';
        results.forEach(result => {
          output += `
            <p><strong>Phone Number:</strong> ${result.phoneNumber}</p>
            <p><strong>Name:</strong> ${result.name}</p>
            <p><strong>Checkbox:</strong> <span id="checkboxStatus${result.row}">${result.checkbox ? 'Checked' : 'Unchecked'}</span></p>
            <button onclick="updateCheckbox(${result.row}, true)">Check</button>
            <button onclick="updateCheckbox(${result.row}, false)">Uncheck</button>
            <hr>
          `;
        });
        document.getElementById('result').innerHTML = output;
        document.getElementById('newRow').style.display = 'none';
      }
    }

    function updateCheckbox(row, checked) {
      google.script.run.updateCheckbox(row, checked);
      document.getElementById(`checkboxStatus${row}`).innerText = checked ? 'Checked' : 'Unchecked';
    }

    function addNewRow() {
      const name = document.getElementById('newName').value;
      const phoneNumber = document.getElementById('newPhone').value;
      if (name && phoneNumber) {
        google.script.run.addNewRow(name, phoneNumber);
        document.getElementById('result').innerHTML = `<p>New row added: ${name}, ${phoneNumber}</p>`;
        document.getElementById('newName').value = '';
        document.getElementById('newPhone').value = '';
      } else {
        document.getElementById('result').innerHTML = '<p style="color:red;">Please fill in both fields.</p>';
      }
    }
  </script>
</body>
</html>
