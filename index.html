const SHEET_NAME = 'Sheet1'; // Sheet name is 'Sheet1'
const CHECKBOX_COLUMN = 3; // Column C for checkboxes
const PHONE_COLUMN = 2; // Column B for phone numbers
const NAME_COLUMN = 1; // Column A for names

// Serve the HTML file hosted on GitHub
function doGet() {
  var url = 'https://raw.githubusercontent.com/HazZz3M/reservation/main/index.html'; // GitHub raw URL
  var html = UrlFetchApp.fetch(url).getContentText();
  return HtmlService.createHtmlOutput(html);
}

// Search for phone numbers or names and return matches
function search(query, type) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME);
  const data = sheet.getDataRange().getValues();
  const results = [];

  for (let i = 1; i < data.length; i++) { // Start from row 1 to skip headers
    const name = data[i][NAME_COLUMN - 1];
    const phoneNumber = data[i][PHONE_COLUMN - 1];
    
    // Search by phone number (last 4 digits)
    if (type === 'phone' && phoneNumber && phoneNumber.toString().endsWith(query)) {
      results.push({
        name: name,
        phoneNumber: phoneNumber,
        row: i + 1, // The row number for checkbox update
        checkbox: data[i][CHECKBOX_COLUMN - 1]
      });
    }
    
    // Search by name
    if (type === 'name' && name && name.toLowerCase().includes(query.toLowerCase())) {
      results.push({
        name: name,
        phoneNumber: phoneNumber,
        row: i + 1,
        checkbox: data[i][CHECKBOX_COLUMN - 1]
      });
    }
  }

  return results.length > 0 ? results : 'not found';
}

// Update the checkbox value for a specific row
function updateCheckbox(row, checked) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME);
  sheet.getRange(row, CHECKBOX_COLUMN).setValue(checked);
}

// Add a new row to the sheet
function addNewRow(name, phoneNumber) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName(SHEET_NAME);
  sheet.appendRow([name, phoneNumber, false]);
}
